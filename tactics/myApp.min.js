var collections;(function(e){function r(e,t){if(e<t){return-1}else if(e===t){return 0}else{return 1}}function i(e,t){return e===t}function s(t){if(t===null){return"COLLECTION_NULL"}else if(e.isUndefined(t)){return"COLLECTION_UNDEFINED"}else if(e.isString(t)){return"$s"+t}else{return"$o"+t.toString()}}function o(t,r){if(typeof r==="undefined"){r=","}if(t===null){return"COLLECTION_NULL"}else if(e.isUndefined(t)){return"COLLECTION_UNDEFINED"}else if(e.isString(t)){return t.toString()}else{var i="{";var s=true;for(var o in t){if(n(t,o)){if(s)s=false;else i=i+r;i=i+o+":"+t[o]}}return i+"}"}}function u(e){return typeof e==="function"}function a(e){return typeof e==="undefined"}function f(e){return Object.prototype.toString.call(e)==="[object String]"}function l(t){if(!e.isFunction(t)){return function(e,t){if(e<t){return 1}else if(e===t){return 0}else{return-1}}}else{return function(e,n){return t(e,n)*-1}}}function c(e){return function(t,n){return e(t,n)===0}}var t=Object.prototype.hasOwnProperty;var n=function(e,n){return t.call(e,n)};e.defaultCompare=r;e.defaultEquals=i;e.defaultToString=s;e.makeString=o;e.isFunction=u;e.isUndefined=a;e.isString=f;e.reverseCompareFunction=l;e.compareToEquals=c;(function(t){function n(t,n,r){var i=r||e.defaultEquals;var s=t.length;for(var o=0;o<s;o++){if(i(t[o],n)){return o}}return-1}function r(t,n,r){var i=r||e.defaultEquals;var s=t.length;for(var o=s-1;o>=0;o--){if(i(t[o],n)){return o}}return-1}function i(e,n,r){return t.indexOf(e,n,r)>=0}function s(e,n,r){var i=t.indexOf(e,n,r);if(i<0){return false}e.splice(i,1);return true}function o(t,n,r){var i=r||e.defaultEquals;var s=t.length;var o=0;for(var u=0;u<s;u++){if(i(t[u],n)){o++}}return o}function u(t,n,r){var i=r||e.defaultEquals;if(t.length!==n.length){return false}var s=t.length;for(var o=0;o<s;o++){if(!i(t[o],n[o])){return false}}return true}function a(e){return e.concat()}function f(e,t,n){if(t<0||t>=e.length||n<0||n>=e.length){return false}var r=e[t];e[t]=e[n];e[n]=r;return true}function l(e){return"["+e.toString()+"]"}function c(e,t){var n=e.length;for(var r=0;r<n;r++){if(t(e[r])===false){return}}}t.indexOf=n;t.lastIndexOf=r;t.contains=i;t.remove=s;t.frequency=o;t.equals=u;t.copy=a;t.swap=f;t.toString=l;t.forEach=c})(e.arrays||(e.arrays={}));var h=e.arrays;var p=function(){function t(){this.firstNode=null;this.lastNode=null;this.nElements=0}t.prototype.add=function(t,n){if(e.isUndefined(n)){n=this.nElements}if(n<0||n>this.nElements||e.isUndefined(t)){return false}var r=this.createNode(t);if(this.nElements===0){this.firstNode=r;this.lastNode=r}else if(n===this.nElements){this.lastNode.next=r;this.lastNode=r}else if(n===0){r.next=this.firstNode;this.firstNode=r}else{var i=this.nodeAtIndex(n-1);r.next=i.next;i.next=r}this.nElements++;return true};t.prototype.first=function(){if(this.firstNode!==null){return this.firstNode.element}return undefined};t.prototype.last=function(){if(this.lastNode!==null){return this.lastNode.element}return undefined};t.prototype.elementAtIndex=function(e){var t=this.nodeAtIndex(e);if(t===null){return undefined}return t.element};t.prototype.indexOf=function(t,n){var r=n||e.defaultEquals;if(e.isUndefined(t)){return-1}var i=this.firstNode;var s=0;while(i!==null){if(r(i.element,t)){return s}s++;i=i.next}return-1};t.prototype.contains=function(e,t){return this.indexOf(e,t)>=0};t.prototype.remove=function(t,n){var r=n||e.defaultEquals;if(this.nElements<1||e.isUndefined(t)){return false}var i=null;var s=this.firstNode;while(s!==null){if(r(s.element,t)){if(s===this.firstNode){this.firstNode=this.firstNode.next;if(s===this.lastNode){this.lastNode=null}}else if(s===this.lastNode){this.lastNode=i;i.next=s.next;s.next=null}else{i.next=s.next;s.next=null}this.nElements--;return true}i=s;s=s.next}return false};t.prototype.clear=function(){this.firstNode=null;this.lastNode=null;this.nElements=0};t.prototype.equals=function(t,n){var r=n||e.defaultEquals;if(!(t instanceof e.LinkedList)){return false}if(this.size()!==t.size()){return false}return this.equalsAux(this.firstNode,t.firstNode,r)};t.prototype.equalsAux=function(e,t,n){while(e!==null){if(!n(e.element,t.element)){return false}e=e.next;t=t.next}return true};t.prototype.removeElementAtIndex=function(e){if(e<0||e>=this.nElements){return undefined}var t;if(this.nElements===1){t=this.firstNode.element;this.firstNode=null;this.lastNode=null}else{var n=this.nodeAtIndex(e-1);if(n===null){t=this.firstNode.element;this.firstNode=this.firstNode.next}else if(n.next===this.lastNode){t=this.lastNode.element;this.lastNode=n}if(n!==null){t=n.next.element;n.next=n.next.next}}this.nElements--;return t};t.prototype.forEach=function(e){var t=this.firstNode;while(t!==null){if(e(t.element)===false){break}t=t.next}};t.prototype.reverse=function(){var e=null;var t=this.firstNode;var n=null;while(t!==null){n=t.next;t.next=e;e=t;t=n}n=this.firstNode;this.firstNode=this.lastNode;this.lastNode=n};t.prototype.toArray=function(){var e=[];var t=this.firstNode;while(t!==null){e.push(t.element);t=t.next}return e};t.prototype.size=function(){return this.nElements};t.prototype.isEmpty=function(){return this.nElements<=0};t.prototype.toString=function(){return e.arrays.toString(this.toArray())};t.prototype.nodeAtIndex=function(e){if(e<0||e>=this.nElements){return null}if(e===this.nElements-1){return this.lastNode}var t=this.firstNode;for(var n=0;n<e;n++){t=t.next}return t};t.prototype.createNode=function(e){return{element:e,next:null}};return t}();e.LinkedList=p;var d=function(){function t(t){this.table={};this.nElements=0;this.toStr=t||e.defaultToString}t.prototype.getValue=function(t){var n=this.table["$"+this.toStr(t)];if(e.isUndefined(n)){return undefined}return n.value};t.prototype.setValue=function(t,n){if(e.isUndefined(t)||e.isUndefined(n)){return undefined}var r;var i="$"+this.toStr(t);var s=this.table[i];if(e.isUndefined(s)){this.nElements++;r=undefined}else{r=s.value}this.table[i]={key:t,value:n};return r};t.prototype.remove=function(t){var n="$"+this.toStr(t);var r=this.table[n];if(!e.isUndefined(r)){delete this.table[n];this.nElements--;return r.value}return undefined};t.prototype.keys=function(){var e=[];for(var t in this.table){if(n(this.table,t)){var r=this.table[t];e.push(r.key)}}return e};t.prototype.values=function(){var e=[];for(var t in this.table){if(n(this.table,t)){var r=this.table[t];e.push(r.value)}}return e};t.prototype.forEach=function(e){for(var t in this.table){if(n(this.table,t)){var r=this.table[t];var i=e(r.key,r.value);if(i===false){return}}}};t.prototype.containsKey=function(t){return!e.isUndefined(this.getValue(t))};t.prototype.clear=function(){this.table={};this.nElements=0};t.prototype.size=function(){return this.nElements};t.prototype.isEmpty=function(){return this.nElements<=0};t.prototype.toString=function(){var e="{";this.forEach(function(t,n){e=e+"\n	"+t.toString()+" : "+n.toString()});return e+"\n}"};return t}();e.Dictionary=d;var v=function(){function t(t,n,r){if(typeof r==="undefined"){r=false}this.dict=new d(t);this.equalsF=n||e.defaultEquals;this.allowDuplicate=r}t.prototype.getValue=function(t){var n=this.dict.getValue(t);if(e.isUndefined(n)){return[]}return e.arrays.copy(n)};t.prototype.setValue=function(t,n){if(e.isUndefined(t)||e.isUndefined(n)){return false}if(!this.containsKey(t)){this.dict.setValue(t,[n]);return true}var r=this.dict.getValue(t);if(!this.allowDuplicate){if(e.arrays.contains(r,n,this.equalsF)){return false}}r.push(n);return true};t.prototype.remove=function(t,n){if(e.isUndefined(n)){var r=this.dict.remove(t);return!e.isUndefined(r)}var i=this.dict.getValue(t);if(e.arrays.remove(i,n,this.equalsF)){if(i.length===0){this.dict.remove(t)}return true}return false};t.prototype.keys=function(){return this.dict.keys()};t.prototype.values=function(){var e=this.dict.values();var t=[];for(var n=0;n<e.length;n++){var r=e[n];for(var i=0;i<r.length;i++){t.push(r[i])}}return t};t.prototype.containsKey=function(e){return this.dict.containsKey(e)};t.prototype.clear=function(){this.dict.clear()};t.prototype.size=function(){return this.dict.size()};t.prototype.isEmpty=function(){return this.dict.isEmpty()};return t}();e.MultiDictionary=v;var m=function(){function t(t){this.data=[];this.compare=t||e.defaultCompare}t.prototype.leftChildIndex=function(e){return 2*e+1};t.prototype.rightChildIndex=function(e){return 2*e+2};t.prototype.parentIndex=function(e){return Math.floor((e-1)/2)};t.prototype.minIndex=function(e,t){if(t>=this.data.length){if(e>=this.data.length){return-1}else{return e}}else{if(this.compare(this.data[e],this.data[t])<=0){return e}else{return t}}};t.prototype.siftUp=function(t){var n=this.parentIndex(t);while(t>0&&this.compare(this.data[n],this.data[t])>0){e.arrays.swap(this.data,n,t);t=n;n=this.parentIndex(t)}};t.prototype.siftDown=function(t){var n=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t));while(n>=0&&this.compare(this.data[t],this.data[n])>0){e.arrays.swap(this.data,n,t);t=n;n=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t))}};t.prototype.peek=function(){if(this.data.length>0){return this.data[0]}else{return undefined}};t.prototype.add=function(t){if(e.isUndefined(t)){return undefined}this.data.push(t);this.siftUp(this.data.length-1);return true};t.prototype.removeRoot=function(){if(this.data.length>0){var e=this.data[0];this.data[0]=this.data[this.data.length-1];this.data.splice(this.data.length-1,1);if(this.data.length>0){this.siftDown(0)}return e}return undefined};t.prototype.contains=function(t){var n=e.compareToEquals(this.compare);return e.arrays.contains(this.data,t,n)};t.prototype.size=function(){return this.data.length};t.prototype.isEmpty=function(){return this.data.length<=0};t.prototype.clear=function(){this.data.length=0};t.prototype.forEach=function(t){e.arrays.forEach(this.data,t)};return t}();e.Heap=m;var g=function(){function e(){this.list=new p}e.prototype.push=function(e){return this.list.add(e,0)};e.prototype.add=function(e){return this.list.add(e,0)};e.prototype.pop=function(){return this.list.removeElementAtIndex(0)};e.prototype.peek=function(){return this.list.first()};e.prototype.size=function(){return this.list.size()};e.prototype.contains=function(e,t){return this.list.contains(e,t)};e.prototype.isEmpty=function(){return this.list.isEmpty()};e.prototype.clear=function(){this.list.clear()};e.prototype.forEach=function(e){this.list.forEach(e)};return e}();e.Stack=g;var y=function(){function e(){this.list=new p}e.prototype.enqueue=function(e){return this.list.add(e)};e.prototype.add=function(e){return this.list.add(e)};e.prototype.dequeue=function(){if(this.list.size()!==0){var e=this.list.first();this.list.removeElementAtIndex(0);return e}return undefined};e.prototype.peek=function(){if(this.list.size()!==0){return this.list.first()}return undefined};e.prototype.size=function(){return this.list.size()};e.prototype.contains=function(e,t){return this.list.contains(e,t)};e.prototype.isEmpty=function(){return this.list.size()<=0};e.prototype.clear=function(){this.list.clear()};e.prototype.forEach=function(e){this.list.forEach(e)};return e}();e.Queue=y;var b=function(){function t(t){this.heap=new m(e.reverseCompareFunction(t))}t.prototype.enqueue=function(e){return this.heap.add(e)};t.prototype.add=function(e){return this.heap.add(e)};t.prototype.dequeue=function(){if(this.heap.size()!==0){var e=this.heap.peek();this.heap.removeRoot();return e}return undefined};t.prototype.peek=function(){return this.heap.peek()};t.prototype.contains=function(e){return this.heap.contains(e)};t.prototype.isEmpty=function(){return this.heap.isEmpty()};t.prototype.size=function(){return this.heap.size()};t.prototype.clear=function(){this.heap.clear()};t.prototype.forEach=function(e){this.heap.forEach(e)};return t}();e.PriorityQueue=b;var w=function(){function t(e){this.dictionary=new d(e)}t.prototype.contains=function(e){return this.dictionary.containsKey(e)};t.prototype.add=function(t){if(this.contains(t)||e.isUndefined(t)){return false}else{this.dictionary.setValue(t,t);return true}};t.prototype.intersection=function(e){var t=this;this.forEach(function(n){if(!e.contains(n)){t.remove(n)}return true})};t.prototype.union=function(e){var t=this;e.forEach(function(e){t.add(e);return true})};t.prototype.difference=function(e){var t=this;e.forEach(function(e){t.remove(e);return true})};t.prototype.isSubsetOf=function(e){if(this.size()>e.size()){return false}var t=true;this.forEach(function(n){if(!e.contains(n)){t=false;return false}return true});return t};t.prototype.remove=function(e){if(!this.contains(e)){return false}else{this.dictionary.remove(e);return true}};t.prototype.forEach=function(e){this.dictionary.forEach(function(t,n){return e(n)})};t.prototype.toArray=function(){return this.dictionary.values()};t.prototype.isEmpty=function(){return this.dictionary.isEmpty()};t.prototype.size=function(){return this.dictionary.size()};t.prototype.clear=function(){this.dictionary.clear()};t.prototype.toString=function(){return e.arrays.toString(this.toArray())};return t}();e.Set=w;var E=function(){function t(t){this.toStrF=t||e.defaultToString;this.dictionary=new d(this.toStrF);this.nElements=0}t.prototype.add=function(t,n){if(typeof n==="undefined"){n=1}if(e.isUndefined(t)||n<=0){return false}if(!this.contains(t)){var r={value:t,copies:n};this.dictionary.setValue(t,r)}else{this.dictionary.getValue(t).copies+=n}this.nElements+=n;return true};t.prototype.count=function(e){if(!this.contains(e)){return 0}else{return this.dictionary.getValue(e).copies}};t.prototype.contains=function(e){return this.dictionary.containsKey(e)};t.prototype.remove=function(t,n){if(typeof n==="undefined"){n=1}if(e.isUndefined(t)||n<=0){return false}if(!this.contains(t)){return false}else{var r=this.dictionary.getValue(t);if(n>r.copies){this.nElements-=r.copies}else{this.nElements-=n}r.copies-=n;if(r.copies<=0){this.dictionary.remove(t)}return true}};t.prototype.toArray=function(){var e=[];var t=this.dictionary.values();var n=t.length;for(var r=0;r<n;r++){var i=t[r];var s=i.value;var o=i.copies;for(var u=0;u<o;u++){e.push(s)}}return e};t.prototype.toSet=function(){var e=new w(this.toStrF);var t=this.dictionary.values();var n=t.length;for(var r=0;r<n;r++){var i=t[r].value;e.add(i)}return e};t.prototype.forEach=function(e){this.dictionary.forEach(function(t,n){var r=n.value;var i=n.copies;for(var s=0;s<i;s++){if(e(r)===false){return false}}return true})};t.prototype.size=function(){return this.nElements};t.prototype.isEmpty=function(){return this.nElements===0};t.prototype.clear=function(){this.nElements=0;this.dictionary.clear()};return t}();e.Bag=E;var S=function(){function t(t){this.root=null;this.compare=t||e.defaultCompare;this.nElements=0}t.prototype.add=function(t){if(e.isUndefined(t)){return false}if(this.insertNode(this.createNode(t))!==null){this.nElements++;return true}return false};t.prototype.clear=function(){this.root=null;this.nElements=0};t.prototype.isEmpty=function(){return this.nElements===0};t.prototype.size=function(){return this.nElements};t.prototype.contains=function(t){if(e.isUndefined(t)){return false}return this.searchNode(this.root,t)!==null};t.prototype.remove=function(e){var t=this.searchNode(this.root,e);if(t===null){return false}this.removeNode(t);this.nElements--;return true};t.prototype.inorderTraversal=function(e){this.inorderTraversalAux(this.root,e,{stop:false})};t.prototype.preorderTraversal=function(e){this.preorderTraversalAux(this.root,e,{stop:false})};t.prototype.postorderTraversal=function(e){this.postorderTraversalAux(this.root,e,{stop:false})};t.prototype.levelTraversal=function(e){this.levelTraversalAux(this.root,e)};t.prototype.minimum=function(){if(this.isEmpty()){return undefined}return this.minimumAux(this.root).element};t.prototype.maximum=function(){if(this.isEmpty()){return undefined}return this.maximumAux(this.root).element};t.prototype.forEach=function(e){this.inorderTraversal(e)};t.prototype.toArray=function(){var e=[];this.inorderTraversal(function(t){e.push(t);return true});return e};t.prototype.height=function(){return this.heightAux(this.root)};t.prototype.searchNode=function(e,t){var n=null;while(e!==null&&n!==0){n=this.compare(t,e.element);if(n<0){e=e.leftCh}else if(n>0){e=e.rightCh}}return e};t.prototype.transplant=function(e,t){if(e.parent===null){this.root=t}else if(e===e.parent.leftCh){e.parent.leftCh=t}else{e.parent.rightCh=t}if(t!==null){t.parent=e.parent}};t.prototype.removeNode=function(e){if(e.leftCh===null){this.transplant(e,e.rightCh)}else if(e.rightCh===null){this.transplant(e,e.leftCh)}else{var t=this.minimumAux(e.rightCh);if(t.parent!==e){this.transplant(t,t.rightCh);t.rightCh=e.rightCh;t.rightCh.parent=t}this.transplant(e,t);t.leftCh=e.leftCh;t.leftCh.parent=t}};t.prototype.inorderTraversalAux=function(e,t,n){if(e===null||n.stop){return}this.inorderTraversalAux(e.leftCh,t,n);if(n.stop){return}n.stop=t(e.element)===false;if(n.stop){return}this.inorderTraversalAux(e.rightCh,t,n)};t.prototype.levelTraversalAux=function(e,t){var n=new y;if(e!==null){n.enqueue(e)}while(!n.isEmpty()){e=n.dequeue();if(t(e.element)===false){return}if(e.leftCh!==null){n.enqueue(e.leftCh)}if(e.rightCh!==null){n.enqueue(e.rightCh)}}};t.prototype.preorderTraversalAux=function(e,t,n){if(e===null||n.stop){return}n.stop=t(e.element)===false;if(n.stop){return}this.preorderTraversalAux(e.leftCh,t,n);if(n.stop){return}this.preorderTraversalAux(e.rightCh,t,n)};t.prototype.postorderTraversalAux=function(e,t,n){if(e===null||n.stop){return}this.postorderTraversalAux(e.leftCh,t,n);if(n.stop){return}this.postorderTraversalAux(e.rightCh,t,n);if(n.stop){return}n.stop=t(e.element)===false};t.prototype.minimumAux=function(e){while(e.leftCh!==null){e=e.leftCh}return e};t.prototype.maximumAux=function(e){while(e.rightCh!==null){e=e.rightCh}return e};t.prototype.heightAux=function(e){if(e===null){return-1}return Math.max(this.heightAux(e.leftCh),this.heightAux(e.rightCh))+1};t.prototype.insertNode=function(e){var t=null;var n=this.root;var r=null;while(n!==null){r=this.compare(e.element,n.element);if(r===0){return null}else if(r<0){t=n;n=n.leftCh}else{t=n;n=n.rightCh}}e.parent=t;if(t===null){this.root=e}else if(this.compare(e.element,t.element)<0){t.leftCh=e}else{t.rightCh=e}return e};t.prototype.createNode=function(e){return{element:e,leftCh:null,rightCh:null,parent:null}};return t}();e.BSTree=S})(collections||(collections={}));var SimpleGame=function(){function e(){this.game=new Phaser.Game(800,600,Phaser.AUTO,"content",{preload:this.preload,create:this.create})}e.prototype.preload=function(){this.game.load.image("greenHex","assets/img/greenHex.png");this.game.load.image("selectHex","assets/img/selectHex.png");this.game.load.image("soldier","assets/img/soldier.png");this.game.load.image("soldier2","assets/img/soldier2.png");this.game.load.image("iconMove","assets/img/iconMove.png");this.game.load.image("iconSword","assets/img/iconSword.png")};e.prototype.create=function(){this.game.state.add("Battle",BattleScene,false);this.game.state.start("Battle")};return e}();window.onload=function(){var e=new SimpleGame};var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];r.prototype=t.prototype;e.prototype=new r};var BattleScene=function(e){function t(){e.apply(this,arguments);this.onTileClicked=new Phaser.Signal;this.camVelX=0;this.camVelY=0}__extends(t,e);t.prototype.create=function(){this.game.world.setBounds(-200,-200,1e3,800);this.gameState=new GameState(this.game);this.stateManager=new BattleStateManager(this.gameState,this);this.stateManager.changeState(BattleState.IDLE);this.map=new Array(t.MAP_WIDTH*t.MAP_HEIGHT);this.mapGroup=this.game.add.group();this.highlights=this.game.add.group();this.unitGroup=this.game.add.group();var e=54;var n=72;for(var r=0;r<10;r++){for(var i=0;i<10;i++){var s=MapDisplay.mapCoordToPixel(i,r);var o=new Phaser.Sprite(this.game,s.x,s.y,"greenHex");this.mapGroup.add(o);this.setMapSprite(i,r,o)}}this.addUnits(this.gameState.units)};t.prototype.addUnits=function(e){for(var t=0;t<e.length;t++){this.addUnit(e[t])}};t.prototype.addUnit=function(e){this.unitGroup.add(e.unitSprite);e.onUnitSelected.add(this.unitSelected,this)};t.prototype.update=function(){var e=this.game.input.activePointer;if(e.isDown){console.log("Input down at world x="+e.worldX+" y="+e.worldY);var t=MapDisplay.pixelToHex(e.worldX,e.worldY);this.onTileClicked.dispatch(t)}this.drag_camera(e);this.update_camera()};t.prototype.unitSelected=function(e){this.stateManager.onUnitSelected(e)};t.prototype.setMapSprite=function(e,n,r){this.map[e+n*t.MAP_WIDTH]=r};t.prototype.getMapSprite=function(e,n){return this.map[e+n*t.MAP_WIDTH]};t.prototype.clearHighlights=function(){this.highlights.removeAll(true)};t.prototype.highlightMapTiles=function(e){for(var t=0;t<e.length;t++){this.highlightMapTile(e[t].x,e[t].y)}};t.prototype.highlightMapTile=function(e,t){var n=MapDisplay.mapCoordToPixel(e,t);var r=new Phaser.Sprite(this.game,n.x,n.y,"selectHex");this.highlights.add(r)};t.prototype.createRadialMenu=function(e,t,n){var r=new RadialMenu(this.game,e,t,n);this.unitGroup.add(r);return r};t.prototype.drag_camera=function(e){var t=3;if(!e.timeDown){return}if(e.isDown&&!e.targetObject){if(this.lastPoint){this.camVelX=(this.lastPoint.x-e.position.x)*t;this.camVelY=(this.lastPoint.y-e.position.y)*t;console.log("Camera velocityX="+this.camVelX+" velocityY="+this.camVelY)}this.lastPoint=e.position.clone()}if(e.isUp){this.lastPoint=null}};t.prototype.update_camera=function(){var e=5;var t=80;this.camVelX=this.clamp(this.camVelX,t,-t);this.camVelY=this.clamp(this.camVelY,t,-t);this.game.camera.x+=this.camVelX;this.game.camera.y+=this.camVelY;if(this.camVelX>e){this.camVelX-=e}else if(this.camVelX<-e){this.camVelX+=e}else{this.camVelX=0}if(this.camVelY>e){this.camVelY-=e}else if(this.camVelY<-e){this.camVelY+=e}else{this.camVelY=0}};t.prototype.clamp=function(e,t,n){var r=e;if(r>t)r=t;else if(r<n)r=n;return r};t.MAP_WIDTH=10;t.MAP_HEIGHT=10;return t}(Phaser.State);var GameState=function(){function e(e){this.units=[];this.graph=new Graph;this.units.push(new Unit(e,4,4,"soldier"));this.units.push(new Unit(e,3,3,"soldier"));this.units.push(new Unit(e,8,4,"soldier2"));this.units.push(new Unit(e,7,3,"soldier2"))}e.prototype.getUnitAt=function(e,t){for(var n=0;n<this.units.length;n++){var r=this.units[n];if(r.tileX===e&&r.tileY===t){return r}}return null};return e}();var BattleState=function(){function e(e,t,n){this.stateMgr=e;this.gameState=t;this.scene=n}e.prototype.enter=function(){};e.prototype.exit=function(){};e.prototype.onUnitSelect=function(e){};e.IDLE="IDLE";e.UNIT_MENU="UNITMENU";e.SELECT_RANGE="SELECTRANGE";return e}();var BattleStateManager=function(){function e(e,t){this.states={};this.gameState=e;this.scene=t;this.states[BattleState.IDLE]=new IdleState(this,this.gameState,this.scene);this.states[BattleState.UNIT_MENU]=new UnitMenuState(this,this.gameState,this.scene);this.states[BattleState.SELECT_RANGE]=new SelectRange(this,this.gameState,this.scene)}e.prototype.changeState=function(e){if(this.currentState)this.currentState.exit();this.currentState=this.states[e];this.currentState.enter()};e.prototype.onUnitSelected=function(e){if(this.currentState)this.currentState.onUnitSelect(e)};return e}();var IdleState=function(e){function t(){e.apply(this,arguments)}__extends(t,e);t.prototype.onUnitSelect=function(e){this.gameState.selectedUnit=e;this.stateMgr.changeState(BattleState.UNIT_MENU)};return t}(BattleState);var UnitMenuState=function(e){function t(){e.apply(this,arguments)}__extends(t,e);t.prototype.enter=function(){var e=this.gameState.selectedUnit;this.actionMenu=this.scene.createRadialMenu(e.unitSprite.x,e.unitSprite.y,e.getActions());this.actionMenu.onChoiceSelected.add(this.onActionSelected,this)};t.prototype.exit=function(){this.actionMenu.onChoiceSelected.remove(this.onActionSelected,this);this.actionMenu.destroy(true);this.actionMenu=null};t.prototype.onActionSelected=function(e){this.gameState.selectedAction=e;this.stateMgr.changeState(BattleState.SELECT_RANGE)};return t}(BattleState);var SelectRange=function(e){function t(){e.apply(this,arguments)}__extends(t,e);t.prototype.enter=function(){var e={x:this.gameState.selectedUnit.tileX,y:this.gameState.selectedUnit.tileY};this.validTiles=this.gameState.selectedAction.findRange(this.gameState.selectedUnit,this.gameState);this.scene.highlightMapTiles(this.validTiles);this.scene.onTileClicked.add(this.onTileClicked,this)};t.prototype.onTileClicked=function(e){for(var t=0;t<this.validTiles.length;t++){var n=this.validTiles[t];if(n.x===e.x&&n.y===e.y){this.gameState.selectedAction.execute(this.gameState,this.gameState.selectedUnit,n);this.stateMgr.changeState(BattleState.IDLE);return}}this.stateMgr.changeState(BattleState.IDLE)};t.prototype.exit=function(){this.scene.onTileClicked.remove(this.onTileClicked,this);this.scene.clearHighlights();this.validTiles=null};return t}(BattleState);var MapData=function(){function e(){}return e}();var TileData=function(){function e(){}return e}();var MapDisplay=function(){function e(){}e.mapCoordToPixel=function(e,t){var n=e*54;var r=t*72+(e%2===0?0:36);return{x:n,y:r}};e.pixelToHex=function(e,t){var n=72;var r=54*2;var i=n;var s=Math.floor(e/r)*2;var o=Math.floor(t/i);var u=e%r;var a=t%i;var f=0;var l=0;if(a<i/2){if(u*2+a<n/2){f=-1;l=-1}else if(u*2-a<n*3/2){f=0;l=0}else{f=1;l=-1}}else{if(u*2-(a-n/2)<0){f=-1;l=0}else if(u*2+(a-n/2)<n*2){f=0;l=0}else{f=1;l=0}}var c=s+f;var h=o+l;console.log("Hex X="+c+" Y="+h);return{x:c,y:h}};return e}();var Graph=function(){function e(){this.tiles=[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1];this.mapWidth=10;this.mapHeight=10;this.initAStar();this._collisionMap=new CollisionMap(this.mapWidth,this.mapHeight)}e.prototype.getTileAt=function(e,t){return this.tiles[e+t*this.mapWidth]};e.prototype.getNeighbors=function(e,t){var n=[];if(t-1>=0){n.push({x:e,y:t-1})}if(t+1<this.mapHeight){n.push({x:e,y:t+1})}if(e%2===0){if(e-1>=0){if(t-1>=0){n.push({x:e-1,y:t-1})}n.push({x:e-1,y:t})}if(e+1<this.mapWidth){if(t-1>=0){n.push({x:e+1,y:t-1})}n.push({x:e+1,y:t})}}else{if(e-1>=0){n.push({x:e-1,y:t});if(t+1<this.mapHeight){n.push({x:e-1,y:t+1})}}if(e+1<this.mapWidth){n.push({x:e+1,y:t});if(t+1<this.mapHeight){n.push({x:e+1,y:t+1})}}}return n};e.prototype.initAStar=function(){this.astarTiles=new Array;for(var e=0;e<this.mapHeight;e++){for(var t=0;t<this.mapWidth;t++){var n=new AStarTile;n.x=t;n.y=e;n.g=-1;this.astarTiles.push(n)}}};e.prototype.getAStarTileAt=function(e,t){return this.astarTiles[e+t*this.mapWidth]};e.prototype.getAStarNeighbors=function(e,t){var n=[];if(t-1>=0){n.push(this.getAStarTileAt(e,t-1))}if(t+1<this.mapHeight){n.push(this.getAStarTileAt(e,t+1))}if(e%2===0){if(e-1>=0){if(t-1>=0){n.push(this.getAStarTileAt(e-1,t-1))}n.push(this.getAStarTileAt(e-1,t))}if(e+1<this.mapWidth){if(t-1>=0){n.push(this.getAStarTileAt(e+1,t-1))}n.push(this.getAStarTileAt(e+1,t))}}else{if(e-1>=0){n.push(this.getAStarTileAt(e-1,t));if(t+1<this.mapHeight){n.push(this.getAStarTileAt(e-1,t+1))}}if(e+1<this.mapWidth){n.push(this.getAStarTileAt(e+1,t));if(t+1<this.mapHeight){n.push(this.getAStarTileAt(e+1,t+1))}}}return n};e.prototype.getCollisionMap=function(e){this._collisionMap.clear();this._collisionMap.generate(e);return this._collisionMap};return e}();var Pathfinder=function(){function e(){}e.prototype.getDistance=function(e,t,n,r){var i=this.convertToCubeCoord(e,t);var s=this.convertToCubeCoord(n,r);return(Math.abs(i.x-s.x)+Math.abs(i.y-s.y)+Math.abs(i.z-s.z))/2};e.prototype.convertToCubeCoord=function(e,t){var n=e;var r=t-(e-(e&1))/2;var i=-n-r;return{x:n,y:i,z:r}};e.findAllPaths=function(e,t,n){var r=e.graph;var i=r.getCollisionMap(e);var s=new collections.PriorityQueue(AStarTile.compare);var o=r.getAStarTileAt(t.x,t.y);o.g=0;s.add(o);var u=[];while(!s.isEmpty()){var a=s.dequeue();var f=r.getAStarNeighbors(a.x,a.y);for(var l=0;l<f.length;l++){var c=f[l];if(i.getTileAt(c.x,c.y)>0)continue;var h=a.g+1;if(h<=n){if(c.g===-1){u.push(c)}if(c.g===-1||h<c.g){c.g=h;s.enqueue(c)}}}}for(var l=0;l<u.length;l++){u[l].g=-1}o.g=-1;return u};return e}();var AStarTile=function(){function e(){}e.compare=function(e,t){return e.g-t.g};return e}();var CollisionMap=function(){function e(e,t){this.mapWidth=e;this.mapHeight=t;this.tiles=new Array(e*t)}e.prototype.clear=function(){for(var e=0;e<this.tiles.length;e++){this.tiles[e]=0}};e.prototype.getTileAt=function(e,t){return this.tiles[e+t*this.mapWidth]};e.prototype.generate=function(e){for(var t=0;t<e.units.length;t++){var n=e.units[t];this.setTileAt(n.tileX,n.tileY,1)}};e.prototype.setTileAt=function(e,t,n){this.tiles[e+t*this.mapWidth]=n};return e}();var RadialButton=function(e){function t(t,n,r,i,s,o,u){e.call(this,n,r,i,s,o,u);this.choice=t}__extends(t,e);return t}(Phaser.Button);var RadialMenu=function(e){function t(n,r,i,s){e.call(this,n);this.onChoiceSelected=new Phaser.Signal;this.x=r;this.y=i;for(var o=0;o<s.length&&o<t.Positions.length;o++){var u=t.Positions[o];var a=new RadialButton(s[o],n,u.x,u.y,s[o].iconName,this.onButtonClicked,this);this.add(a)}}__extends(t,e);t.prototype.onButtonClicked=function(e,t,n){if(n){this.onChoiceSelected.dispatch(e.choice)}};t.Positions=[{x:0,y:80},{x:57,y:57},{x:80,y:0},{x:57,y:-57},{x:0,y:-80},{x:-57,y:-57},{x:-80,y:0},{x:-57,y:57}];return t}(Phaser.Group);var Unit=function(){function e(e,t,n,r){this.onUnitSelected=new Phaser.Signal;this.moveStat=4;this.tileX=t;this.tileY=n;this.unitSprite=new UnitSprite(e,t,n,r);this.unitSprite.events.onInputUp.add(this.unitClicked,this)}e.prototype.unitClicked=function(e,t,n){if(n){this.onUnitSelected.dispatch(this)}};e.prototype.moveTo=function(e,t){this.tileX=e;this.tileY=t;this.unitSprite.setLocation(e,t)};e.prototype.getActions=function(){var e=new Array;e.push(new MoveAction);e.push(new AttackAction);return e};return e}();var UnitSprite=function(e){function t(t,n,r,i){e.call(this,t,0,0,i);this.inputEnabled=true;this.setLocation(n,r)}__extends(t,e);t.prototype.setLocation=function(e,n){var r=MapDisplay.mapCoordToPixel(e,n);this.x=r.x+t.DISPLAY_X_OFFSET;this.y=r.y+t.DISPLAY_Y_OFFSET};t.DISPLAY_X_OFFSET=20;t.DISPLAY_Y_OFFSET=20;return t}(Phaser.Sprite);var MoveAction=function(){function e(){this.iconName="iconMove"}e.prototype.findRange=function(e,t){return Pathfinder.findAllPaths(t,{x:e.tileX,y:e.tileY},e.moveStat)};e.prototype.execute=function(e,t,n){t.moveTo(n.x,n.y)};return e}();var AttackAction=function(){function e(){this.iconName="iconSword"}e.prototype.findRange=function(e,t){return Pathfinder.findAllPaths(t,{x:e.tileX,y:e.tileY},1)};e.prototype.execute=function(e,t,n){var r=e.getUnitAt(n.x,n.y);if(r){}};return e}()